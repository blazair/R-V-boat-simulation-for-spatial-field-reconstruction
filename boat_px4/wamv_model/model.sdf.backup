<?xml version="1.0"?>
<sdf version="1.9">
  <model name="wamv_px4">
    <pose>0 0 0.3 0 0 0</pose>

    <link name="base_link">
      <inertial>
        <mass>180.0</mass>
        <inertia>
          <ixx>120.0</ixx>
          <ixy>0.0</ixy>
          <ixz>0.0</ixz>
          <iyy>393.0</iyy>
          <iyz>0.0</iyz>
          <izz>446.0</izz>
        </inertia>
      </inertial>

      <visual name="base_visual">
        <geometry>
          <mesh>
            <uri>model://wamv_px4/meshes/WAM-V-Base.dae</uri>
          </mesh>
        </geometry>
      </visual>

      <collision name="main_collision">
        <pose>0 0 0.5 0 0 0</pose>
        <geometry>
          <box>
            <size>4.0 2.2 0.5</size>
          </box>
        </geometry>
      </collision>

      <!-- IMU Sensor -->
      <sensor name="imu_sensor" type="imu">
        <pose>0 0 0 0 0 0</pose>
        <always_on>1</always_on>
        <update_rate>250</update_rate>
        <imu>
          <angular_velocity>
            <x>
              <noise type="gaussian">
                <mean>0.0</mean>
                <stddev>2e-4</stddev>
              </noise>
            </x>
            <y>
              <noise type="gaussian">
                <mean>0.0</mean>
                <stddev>2e-4</stddev>
              </noise>
            </y>
            <z>
              <noise type="gaussian">
                <mean>0.0</mean>
                <stddev>2e-4</stddev>
              </noise>
            </z>
          </angular_velocity>
          <linear_acceleration>
            <x>
              <noise type="gaussian">
                <mean>0.0</mean>
                <stddev>1.7e-2</stddev>
              </noise>
            </x>
            <y>
              <noise type="gaussian">
                <mean>0.0</mean>
                <stddev>1.7e-2</stddev>
              </noise>
            </y>
            <z>
              <noise type="gaussian">
                <mean>0.0</mean>
                <stddev>1.7e-2</stddev>
              </noise>
            </z>
          </linear_acceleration>
        </imu>
      </sensor>

      <!-- Magnetometer Sensor -->
      <sensor name="magnetometer" type="magnetometer">
        <pose>0 0 0 0 0 0</pose>
        <always_on>1</always_on>
        <update_rate>100</update_rate>
        <magnetometer>
          <x>
            <noise type="gaussian">
              <mean>0.0</mean>
              <stddev>0.01</stddev>
            </noise>
          </x>
          <y>
            <noise type="gaussian">
              <mean>0.0</mean>
              <stddev>0.01</stddev>
            </noise>
          </y>
          <z>
            <noise type="gaussian">
              <mean>0.0</mean>
              <stddev>0.01</stddev>
            </noise>
          </z>
        </magnetometer>
      </sensor>

      <!-- Air Pressure Sensor (Barometer) -->
      <sensor name="air_pressure_sensor" type="air_pressure">
        <pose>0 0 0 0 0 0</pose>
        <always_on>1</always_on>
        <update_rate>50</update_rate>
        <air_pressure>
          <pressure>
            <noise type="gaussian">
              <mean>0.0</mean>
              <stddev>0.01</stddev>
            </noise>
          </pressure>
        </air_pressure>
      </sensor>

      <!-- GPS Sensor -->
      <sensor name="navsat_sensor" type="navsat">
        <pose>0.3 0 1.3 0 0 0</pose>
        <always_on>1</always_on>
        <update_rate>10</update_rate>
        <navsat>
          <position_sensing>
            <horizontal>
              <noise type="gaussian">
                <mean>0.0</mean>
                <stddev>2e-4</stddev>
              </noise>
            </horizontal>
            <vertical>
              <noise type="gaussian">
                <mean>0.0</mean>
                <stddev>4e-4</stddev>
              </noise>
            </vertical>
          </position_sensing>
          <velocity_sensing>
            <horizontal>
              <noise type="gaussian">
                <mean>0.0</mean>
                <stddev>1e-3</stddev>
              </noise>
            </horizontal>
            <vertical>
              <noise type="gaussian">
                <mean>0.0</mean>
                <stddev>1e-3</stddev>
              </noise>
            </vertical>
          </velocity_sensing>
        </navsat>
      </sensor>
    </link>

    <!-- LEFT ENGINE -->
    <link name="left_engine_link">
      <pose relative_to="base_link">-2.373776 1.027135 0.318237 0 0 0</pose>
      <inertial>
        <mass>15.0</mass>
        <inertia>
          <ixx>0.889245</ixx>
          <ixy>0.0</ixy>
          <ixz>0.0</ixz>
          <iyy>0.911125</iyy>
          <iyz>0.0</iyz>
          <izz>0.078125</izz>
        </inertia>
      </inertial>
      <visual name="left_engine_visual">
        <geometry>
          <mesh>
            <uri>model://wamv_px4/meshes/engine.dae</uri>
          </mesh>
        </geometry>
      </visual>
    </link>

    <!-- LEFT PROPELLER -->
    <link name="left_propeller_link">
      <pose relative_to="left_engine_link">-0.278156 0 -0.509371 0 0 0</pose>
      <inertial>
        <mass>0.5</mass>
        <inertia>
          <ixx>0.008545</ixx>
          <ixy>0.0</ixy>
          <ixz>0.0</ixz>
          <iyy>0.008545</iyy>
          <iyz>0.0</iyz>
          <izz>0.0144</izz>
        </inertia>
      </inertial>
      <visual name="left_propeller_visual">
        <geometry>
          <mesh>
            <uri>model://wamv_px4/meshes/propeller.dae</uri>
          </mesh>
        </geometry>
      </visual>
    </link>

    <!-- RIGHT ENGINE -->
    <link name="right_engine_link">
      <pose relative_to="base_link">-2.373776 -1.027135 0.318237 0 0 0</pose>
      <inertial>
        <mass>15.0</mass>
        <inertia>
          <ixx>0.889245</ixx>
          <ixy>0.0</ixy>
          <ixz>0.0</ixz>
          <iyy>0.911125</iyy>
          <iyz>0.0</iyz>
          <izz>0.078125</izz>
        </inertia>
      </inertial>
      <visual name="right_engine_visual">
        <geometry>
          <mesh>
            <uri>model://wamv_px4/meshes/engine.dae</uri>
          </mesh>
        </geometry>
      </visual>
    </link>

    <!-- RIGHT PROPELLER -->
    <link name="right_propeller_link">
      <pose relative_to="right_engine_link">-0.278156 0 -0.509371 0 0 0</pose>
      <inertial>
        <mass>0.5</mass>
        <inertia>
          <ixx>0.008545</ixx>
          <ixy>0.0</ixy>
          <ixz>0.0</ixz>
          <iyy>0.008545</iyy>
          <iyz>0.0</iyz>
          <izz>0.0144</izz>
        </inertia>
      </inertial>
      <visual name="right_propeller_visual">
        <geometry>
          <mesh>
            <uri>model://wamv_px4/meshes/propeller.dae</uri>
          </mesh>
        </geometry>
      </visual>
    </link>

    <!-- JOINTS -->
    <joint name="left_engine_joint" type="revolute">
      <parent>base_link</parent>
      <child>left_engine_link</child>
      <axis>
        <xyz>0 0 1</xyz>
        <limit>
          <lower>-3.14159</lower>
          <upper>3.14159</upper>
        </limit>
      </axis>
    </joint>

    <joint name="left_propeller_joint" type="revolute">
      <parent>left_engine_link</parent>
      <child>left_propeller_link</child>
      <axis>
        <xyz>1 0 0</xyz>
      </axis>
    </joint>

    <joint name="right_engine_joint" type="revolute">
      <parent>base_link</parent>
      <child>right_engine_link</child>
      <axis>
        <xyz>0 0 1</xyz>
        <limit>
          <lower>-3.14159</lower>
          <upper>3.14159</upper>
        </limit>
      </axis>
    </joint>

    <joint name="right_propeller_joint" type="revolute">
      <parent>right_engine_link</parent>
      <child>right_propeller_link</child>
      <axis>
        <xyz>1 0 0</xyz>
      </axis>
    </joint>

    <!-- THRUSTER PLUGINS -->
    <plugin filename="gz-sim-thruster-system" name="gz::sim::systems::Thruster">
      <joint_name>left_propeller_joint</joint_name>
      <thrust_coefficient>0.004422</thrust_coefficient>
      <fluid_density>1000</fluid_density>
      <propeller_diameter>0.2</propeller_diameter>
      <velocity_control>true</velocity_control>
      <max_thrust_cmd>250</max_thrust_cmd>
      <namespace>wamv_px4</namespace>
      <topic>left_thruster</topic>
    </plugin>

    <plugin filename="gz-sim-thruster-system" name="gz::sim::systems::Thruster">
      <joint_name>right_propeller_joint</joint_name>
      <thrust_coefficient>0.004422</thrust_coefficient>
      <fluid_density>1000</fluid_density>
      <propeller_diameter>0.2</propeller_diameter>
      <velocity_control>true</velocity_control>
      <max_thrust_cmd>250</max_thrust_cmd>
      <namespace>wamv_px4</namespace>
      <topic>right_thruster</topic>
    </plugin>

    <!-- BUOYANCY PLUGIN - Makes the boat float -->
    <plugin filename="gz-sim-buoyancy-system" name="gz::sim::systems::Buoyancy">
      <uniform_fluid_density>1000</uniform_fluid_density>
      <graded_buoyancy>
        <default_density>400</default_density>
        <density_change>
          <above_depth>0</above_depth>
          <density>1000</density>
        </density_change>
      </graded_buoyancy>
      <enable>base_link</enable>
    </plugin>

    <!-- PX4 MAVLINK INTERFACE -->
    <plugin filename="gz-sim-multicopter-motor-model-system" name="gz::sim::systems::MulticopterMotorModel">
      <jointName>left_propeller_joint</jointName>
      <linkName>left_propeller_link</linkName>
      <turningDirection>ccw</turningDirection>
      <timeConstantUp>0.0125</timeConstantUp>
      <timeConstantDown>0.025</timeConstantDown>
      <maxRotVelocity>3500</maxRotVelocity>
      <motorConstant>8.54858e-06</motorConstant>
      <momentConstant>0.01</momentConstant>
      <commandSubTopic>command/motor_speed</commandSubTopic>
      <motorNumber>0</motorNumber>
      <rotorDragCoefficient>0.000175</rotorDragCoefficient>
      <rollingMomentCoefficient>1e-06</rollingMomentCoefficient>
      <motorSpeedPubTopic>motor_speed/0</motorSpeedPubTopic>
      <rotorVelocitySlowdownSim>10</rotorVelocitySlowdownSim>
      <motorType>velocity</motorType>
    </plugin>

    <plugin filename="gz-sim-multicopter-motor-model-system" name="gz::sim::systems::MulticopterMotorModel">
      <jointName>right_propeller_joint</jointName>
      <linkName>right_propeller_link</linkName>
      <turningDirection>cw</turningDirection>
      <timeConstantUp>0.0125</timeConstantUp>
      <timeConstantDown>0.025</timeConstantDown>
      <maxRotVelocity>3500</maxRotVelocity>
      <motorConstant>8.54858e-06</motorConstant>
      <momentConstant>0.01</momentConstant>
      <commandSubTopic>command/motor_speed</commandSubTopic>
      <motorNumber>1</motorNumber>
      <rotorDragCoefficient>0.000175</rotorDragCoefficient>
      <rollingMomentCoefficient>1e-06</rollingMomentCoefficient>
      <motorSpeedPubTopic>motor_speed/1</motorSpeedPubTopic>
      <rotorVelocitySlowdownSim>10</rotorVelocitySlowdownSim>
      <motorType>velocity</motorType>
    </plugin>

  </model>
</sdf>
